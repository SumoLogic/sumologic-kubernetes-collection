---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: jolokia
  namespace: demo-jolokia-docker
spec:
  selector:
    matchLabels:
      app: jolokia
  serviceName: jolokia
  template:
    metadata:
      labels:
        app: jolokia
      annotations:
        telegraf.influxdata.com/inputs: |+
          [[inputs.jolokia2_agent]]
            urls = ["http://127.0.0.1:8778/jolokia"]

            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_GarbageCollector"
              mbean = "java.lang:name=*,type=GarbageCollector"
              paths = ["LastGcInfo", "CollectionTime", "Valid", "CollectionCount"]
              tag_keys = ["name"]
            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_Threading"
              mbean = "java.lang:type=Threading"
              paths = ["ThreadAllocatedMemorySupported", "ThreadContentionMonitoringEnabled", "CurrentThreadAllocatedBytes", "TotalStartedThreadCount", "CurrentThreadCpuTimeSupported", "CurrentThreadUserTime", "PeakThreadCount", "ThreadAllocatedMemoryEnabled", "CurrentThreadCpuTime", "ThreadContentionMonitoringSupported", "ThreadCpuTimeSupported", "ThreadCount", "ThreadCpuTimeEnabled", "ObjectMonitorUsageSupported", "SynchronizerUsageSupported", "DaemonThreadCount"]
              tag_keys = []
            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_MemoryPool"
              mbean = "java.lang:name=*,type=MemoryPool"
              paths = ["Usage", "PeakUsage", "CollectionUsage", "UsageThresholdSupported", "CollectionUsageThresholdSupported", "Valid"]
              tag_keys = ["name"]
            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_Memory"
              mbean = "java.lang:type=Memory"
              paths = ["ObjectPendingFinalizationCount", "Verbose", "HeapMemoryUsage", "NonHeapMemoryUsage"]
              tag_keys = []
            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_OperatingSystem"
              mbean = "java.lang:type=OperatingSystem"
              paths = ["OpenFileDescriptorCount", "CommittedVirtualMemorySize", "FreePhysicalMemorySize", "SystemLoadAverage", "ProcessCpuLoad", "FreeSwapSpaceSize", "TotalPhysicalMemorySize", "TotalSwapSpaceSize", "TotalMemorySize", "ProcessCpuTime", "MaxFileDescriptorCount", "SystemCpuLoad", "AvailableProcessors", "CpuLoad", "FreeMemorySize"]
              tag_keys = []
            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_MemoryManager"
              mbean = "java.lang:name=*,type=MemoryManager"
              paths = ["Valid"]
              tag_keys = ["name"]
            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_ClassLoading"
              mbean = "java.lang:type=ClassLoading"
              paths = ["UnloadedClassCount", "LoadedClassCount", "Verbose", "TotalLoadedClassCount"]
              tag_keys = []
            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_Compilation"
              mbean = "java.lang:type=Compilation"
              paths = ["CompilationTimeMonitoringSupported", "TotalCompilationTime"]
              tag_keys = []
            [[inputs.jolokia2_agent.metric]]
              name  = "sumologic_java_lang_Runtime"
              mbean = "java.lang:type=Runtime"
              paths = ["Uptime", "StartTime", "Pid", "BootClassPathSupported"]
              tag_keys = []

        telegraf.influxdata.com/class: sumologic-prometheus
        telegraf.influxdata.com/limits-cpu: '750m'
        prometheus.io/scrape: "true"
        prometheus.io/port: "9273"
    spec:
      containers:
      - name: jolokia
        image: localhost:32000/jolokia/docker
