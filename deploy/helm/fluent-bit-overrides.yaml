# This file is auto-generated.
## Resource limits for fluent-bit
resources: {}
# limits:
#   cpu: 100m
#   memory: 128Mi
# requests:
#   cpu: 10m
#   memory: 8Mi

## Uncomment the flag below to not install fluent-bit helm chart as a dependency along with this helm chart.
## Comment it out if you wish to have the fluent-bit dependency installed.
## Setting the flag to true instead of commenting out will break other functionality. 
# enabled: false
env:
  - name: CHART
    valueFrom:
      configMapKeyRef:
        name: sumologic-configmap
        key: fluentdLogs
  - name: NAMESPACE
    valueFrom:
      fieldRef:
        fieldPath: metadata.namespace
serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 30s
tolerations:
  - effect: NoSchedule
    operator: Exists
extraVolumeMounts:
  - mountPath: /tail-db
    name: tail-db
extraVolumes:
  - hostPath:
      path: /var/lib/fluent-bit
      type: DirectoryOrCreate
    name: tail-db
config:
  service: |
    [SERVICE]
        Flush        5   #new fluent-bit uses deault of 1
        Daemon       Off
        Log_Level    info
        Parsers_File parsers.conf
        Parsers_File custom_parsers.conf
        HTTP_Server  On
        HTTP_Listen  0.0.0.0
        HTTP_Port    2020
  inputs: |
    [INPUT]
        Name             tail
        Path             /var/log/containers/*.log
        Multiline        On
        Parser_Firstline docker
        Tag              containers.*
        Refresh_Interval 1
        Rotate_Wait      60
        Mem_Buf_Limit    5MB
        Skip_Long_Lines  On
        DB               /tail-db/tail-containers-state-sumo.db
        DB.Sync          Normal
        Ignore_Older     24h
    [INPUT]
        Name            systemd
        Tag             host.*
        DB              /tail-db/systemd-state-sumo.db
        Systemd_Filter  _SYSTEMD_UNIT=addon-config.service
        Systemd_Filter  _SYSTEMD_UNIT=addon-run.service
        Systemd_Filter  _SYSTEMD_UNIT=cfn-etcd-environment.service
        Systemd_Filter  _SYSTEMD_UNIT=cfn-signal.service
        Systemd_Filter  _SYSTEMD_UNIT=clean-ca-certificates.service
        Systemd_Filter  _SYSTEMD_UNIT=containerd.service
        Systemd_Filter  _SYSTEMD_UNIT=coreos-metadata.service
        Systemd_Filter  _SYSTEMD_UNIT=coreos-setup-environment.service
        Systemd_Filter  _SYSTEMD_UNIT=coreos-tmpfiles.service
        Systemd_Filter  _SYSTEMD_UNIT=dbus.service
        Systemd_Filter  _SYSTEMD_UNIT=docker.service
        Systemd_Filter  _SYSTEMD_UNIT=efs.service
        Systemd_Filter  _SYSTEMD_UNIT=etcd-member.service
        Systemd_Filter  _SYSTEMD_UNIT=etcd.service
        Systemd_Filter  _SYSTEMD_UNIT=etcd2.service
        Systemd_Filter  _SYSTEMD_UNIT=etcd3.service
        Systemd_Filter  _SYSTEMD_UNIT=etcdadm-check.service
        Systemd_Filter  _SYSTEMD_UNIT=etcdadm-reconfigure.service
        Systemd_Filter  _SYSTEMD_UNIT=etcdadm-save.service
        Systemd_Filter  _SYSTEMD_UNIT=etcdadm-update-status.service
        Systemd_Filter  _SYSTEMD_UNIT=flanneld.service
        Systemd_Filter  _SYSTEMD_UNIT=format-etcd2-volume.service
        Systemd_Filter  _SYSTEMD_UNIT=kube-node-taint-and-uncordon.service
        Systemd_Filter  _SYSTEMD_UNIT=kubelet.service
        Systemd_Filter  _SYSTEMD_UNIT=ldconfig.service
        Systemd_Filter  _SYSTEMD_UNIT=locksmithd.service
        Systemd_Filter  _SYSTEMD_UNIT=logrotate.service
        Systemd_Filter  _SYSTEMD_UNIT=lvm2-monitor.service
        Systemd_Filter  _SYSTEMD_UNIT=mdmon.service
        Systemd_Filter  _SYSTEMD_UNIT=nfs-idmapd.service
        Systemd_Filter  _SYSTEMD_UNIT=nfs-mountd.service
        Systemd_Filter  _SYSTEMD_UNIT=nfs-server.service
        Systemd_Filter  _SYSTEMD_UNIT=nfs-utils.service
        Systemd_Filter  _SYSTEMD_UNIT=node-problem-detector.service
        Systemd_Filter  _SYSTEMD_UNIT=ntp.service
        Systemd_Filter  _SYSTEMD_UNIT=oem-cloudinit.service
        Systemd_Filter  _SYSTEMD_UNIT=rkt-gc.service
        Systemd_Filter  _SYSTEMD_UNIT=rkt-metadata.service
        Systemd_Filter  _SYSTEMD_UNIT=rpc-idmapd.service
        Systemd_Filter  _SYSTEMD_UNIT=rpc-mountd.service
        Systemd_Filter  _SYSTEMD_UNIT=rpc-statd.service
        Systemd_Filter  _SYSTEMD_UNIT=rpcbind.service
        Systemd_Filter  _SYSTEMD_UNIT=set-aws-environment.service
        Systemd_Filter  _SYSTEMD_UNIT=system-cloudinit.service
        Systemd_Filter  _SYSTEMD_UNIT=systemd-timesyncd.service
        Systemd_Filter  _SYSTEMD_UNIT=update-ca-certificates.service
        Systemd_Filter  _SYSTEMD_UNIT=user-cloudinit.service
        Systemd_Filter  _SYSTEMD_UNIT=var-lib-etcd2.service
        Max_Entries     1000
        Read_From_Tail  true
  outputs: |
    [OUTPUT]
        Name          forward
        Match         *
        Host          ${CHART}.${NAMESPACE}.svc.cluster.local.
        Port          24321
        Retry_Limit False
        tls           off
        tls.verify    on
        tls.debug     1
  customParsers: |
    [PARSER]
        Name        multi_line
        Format      regex
        Regex       (?<log>^{"log":"\d{4}-\d{1,2}-\d{1,2}.\d{2}:\d{2}:\d{2}.*)
