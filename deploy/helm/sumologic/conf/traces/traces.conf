<source>
  @type zipkin
  @label @TRACING
  port 9411
</source>
<label @TRACING>
  <filter tracing.**>
    @type kubernetes_sumologic
    tracing_format true
    tracing_namespace {{ include "utils.get_default" (dict "Values" .Values "Keys" (list "otelcol" "config" "processors" "k8s_tagger" "extract" "tags" "namespace") "Default" "namespace") | quote }}
    tracing_pod {{ include "utils.get_default" (dict "Values" .Values "Keys" (list "otelcol" "config" "processors" "k8s_tagger" "extract" "tags" "podName") "Default" "pod") | quote }}
    tracing_pod_id {{ include "utils.get_default" (dict "Values" .Values "Keys" (list "otelcol" "config" "processors" "k8s_tagger" "extract" "tags" "podId") "Default" "pod_id") | quote }}
    tracing_container_name {{ include "utils.get_default" (dict "Values" .Values "Keys" (list "otelcol" "config" "processors" "k8s_tagger" "extract" "tags" "containerName") "Default" "container_name") | quote }}
    tracing_host {{ include "utils.get_default" (dict "Values" .Values "Keys" (list "otelcol" "config" "processors" "k8s_tagger" "extract" "tags" "hostName") "Default" "hostname") | quote }}
    tracing_label_prefix 'pod_label_'
    tracing_annotation_prefix 'pod_annotation_'
    source_host_key_name '_sourceHost'
    source_category_key_name '_sourceCategory'
    source_name_key_name '_sourceName'
    collector_key_name '_collector'
    collector_value "{{- if .Values.sumologic.collectorName }}{{ .Values.sumologic.collectorName }}{{- else}}{{ .Values.sumologic.clusterName }}{{- end}}"

    source_name "#{ENV['SOURCE_NAME']}"
    source_host "#{ENV['SOURCE_HOST']}"
    log_format "#{ENV['LOG_FORMAT']}"
    kubernetes_meta "#{ENV['KUBERNETES_META']}"
    kubernetes_meta_reduce "#{ENV['KUBERNETES_META_REDUCE']}"
    add_stream "#{ENV['ADD_STREAM']}"
    add_time "#{ENV['ADD_TIME']}"
    source_category "#{ENV['SOURCE_CATEGORY']}"
    source_category_prefix "#{ENV['SOURCE_CATEGORY_PREFIX']}"
    source_category_replace_dash "#{ENV['SOURCE_CATEGORY_REPLACE_DASH']}"
    exclude_namespace_regex "#{ENV['EXCLUDE_NAMESPACE_REGEX']}"
    exclude_pod_regex "#{ENV['EXCLUDE_POD_REGEX']}"
    exclude_container_regex "#{ENV['EXCLUDE_CONTAINER_REGEX']}"
    exclude_host_regex "#{ENV['EXCLUDE_HOST_REGEX']}"
  </filter>
{{- if .Values.sumologic.traces.fluentd_stdout }}
  <filter tracing.**>
    @type stdout
  </filter>
{{- end }}
  <match tracing.**>
    @type zipkin
    endpoint "#{ENV['SUMO_ENDPOINT_TRACES']}"
    content_type application/json
    open_timeout 1
    spans_per_request {{ .Values.sumologic.traces.spans_per_request }}
    <buffer>
      {{- if eq .Values.sumologic.fluentd.buffer "file" }}
      @type file
      path /fluentd/buffer/events
      {{- else }}
      @type memory
      {{- end }}
      @include buffer.output.conf
    </buffer>
  </match>
</label>