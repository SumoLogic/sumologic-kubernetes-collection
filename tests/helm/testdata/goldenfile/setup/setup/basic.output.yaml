---
# Source: sumologic/templates/setup/job.yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: RELEASE-NAME-sumologic-setup
  annotations:
    helm.sh/hook: pre-install,pre-upgrade
    helm.sh/hook-weight: "3"
    helm.sh/hook-delete-policy: before-hook-creation,hook-succeeded
  labels:
    app: RELEASE-NAME-sumologic
    chart: "sumologic-%CURRENT_CHART_VERSION%"
    release: "RELEASE-NAME"
    heritage: "Helm"
spec:
  template:
    metadata:
      annotations:
      labels:
    spec:
      restartPolicy: OnFailure
      serviceAccountName: RELEASE-NAME-sumologic-setup
      volumes:
        - name: setup
          configMap:
            name: RELEASE-NAME-sumologic-setup
            defaultMode: 0777
        - name: custom
          configMap:
            name: RELEASE-NAME-sumologic-setup-custom
            defaultMode: 0777
      containers:
        - name: setup
          image: public.ecr.aws/sumologic/kubernetes-setup:%CURRENT_CHART_VERSION%
          imagePullPolicy: IfNotPresent
          command: ["/etc/terraform/setup.sh"]
          resources:
            limits:
              cpu: 2000m
              memory: 256Mi
            requests:
              cpu: 200m
              memory: 64Mi
          volumeMounts:
            - name: setup
              mountPath: /etc/terraform
            - name: custom
              mountPath: /customer-scripts
          envFrom:
            - secretRef:
                name: RELEASE-NAME-sumologic-setup
          env:
            - name: SUMOLOGIC_BASE_URL
              value:
            - name: NO_PROXY
              value: kubernetes.default.svc
      securityContext:
        runAsUser: 999
