---
# Source: sumologic/templates/logs/collector/otelcol/configmap-windows.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: RELEASE-NAME-sumologic-otelcol-windows-logs-collector
  namespace: sumologic
  labels:
    app: RELEASE-NAME-sumologic-otelcol-logs-collector
    chart: "sumologic-%CURRENT_CHART_VERSION%"
    release: "RELEASE-NAME"
    heritage: "Helm"
data:
  config.yaml: |
    exporters:
      otlphttp:
        disable_keep_alives: true
        endpoint: http://${LOGS_METADATA_SVC}.${NAMESPACE}.svc.cluster.local.:4318
        sending_queue:
          queue_size: 10
    extensions:
      file_storage:
        compaction:
          directory: /var/lib/storage/otc
          on_rebound: true
        directory: /var/lib/storage/otc
        timeout: 10s
      health_check: {}
      pprof: {}
    processors:
      batch:
        send_batch_max_size: 2000
        send_batch_size: 1000
        timeout: 1s
      logstransform/systemd:
        operators:
        - from: body._SYSTEMD_UNIT
          to: attributes._SYSTEMD_UNIT
          type: copy
        - from: body.SYSLOG_FACILITY
          to: attributes.SYSLOG_FACILITY
          type: copy
        - from: body._HOSTNAME
          to: attributes._HOSTNAME
          type: copy
        - from: body.PRIORITY
          to: attributes.PRIORITY
          type: copy
        - field: attributes["fluent.tag"]
          type: add
          value: EXPR("host." + attributes["_SYSTEMD_UNIT"])
        - field: body.__CURSOR
          type: remove
        - field: body.__MONOTONIC_TIMESTAMP
          type: remove
    receivers: null
    service:
      extensions:
      - health_check
      - file_storage
      - pprof
      pipelines: null
      telemetry:
        logs:
          level: debug
