fluent-bit:
  podLabels: {}
  podAnnotations: {}
  env:
    - name: FLUENTD_LOGS_SVC
      valueFrom:
        configMapKeyRef:
          name: sumologic-configmap
          key: fluentdLogs
    - name: NAMESPACE
      valueFrom:
        fieldRef:
          fieldPath: metadata.namespace
  extraVolumes:
    - name: project2-db
      emptyDir: {}
    - name: project-db
      emptyDir: {}
    - name: project2-alerts
      hostPath:
        path: /var/project2/logs/alerts/alerts.json
        type: File
    - name: company-db
      emptyDir: {}
  extraVolumeMounts:
    - name: project2-db
      mountPath: /fluent-bit/project2
    - name: project-db
      mountPath: /fluent-bit/project
    - name: project2-alerts
      mountPath: /var/project2/logs/alerts/alerts.json
      readOnly: true
    - name: company-db
      mountPath: /fluent-bit/company
  tolerations:
    - effect: NoSchedule
      operator: Exists
  image:
    repository: public.ecr.aws/sumologic/fluent-bit
    tag: 1.6.10
    pullPolicy: Always
  service:
    labels:
      sumologic.com/scrape: "true"
  config:
    inputs: |-
      [INPUT]
          Name                  tail
          Path                  /var/log/containers/*.log
          Docker_Mode           On
          Docker_Mode_Parser    multi_line
          Tag                   containers.*
          Refresh_Interval      1
          Rotate_Wait           60
          Mem_Buf_Limit         5MB
          Skip_Long_Lines       On
          DB                    /tail-db/tail-containers-state-sumo.db
          DB.Sync               Normal
      [INPUT]
          Name                  systemd
          Tag                   host.*
          DB                    /tail-db/systemd-state-sumo.db
          Systemd_Filter        _SYSTEMD_UNIT=addon-config.service
          Systemd_Filter        _SYSTEMD_UNIT=addon-run.service
          Systemd_Filter        _SYSTEMD_UNIT=cfn-etcd-environment.service
          Systemd_Filter        _SYSTEMD_UNIT=cfn-signal.service
          Systemd_Filter        _SYSTEMD_UNIT=clean-ca-certificates.service
          Systemd_Filter        _SYSTEMD_UNIT=containerd.service
          Systemd_Filter        _SYSTEMD_UNIT=coreos-metadata.service
          Systemd_Filter        _SYSTEMD_UNIT=coreos-setup-environment.service
          Systemd_Filter        _SYSTEMD_UNIT=coreos-tmpfiles.service
          Systemd_Filter        _SYSTEMD_UNIT=dbus.service
          Systemd_Filter        _SYSTEMD_UNIT=docker.service
          Systemd_Filter        _SYSTEMD_UNIT=efs.service
          Systemd_Filter        _SYSTEMD_UNIT=etcd-member.service
          Systemd_Filter        _SYSTEMD_UNIT=etcd.service
          Systemd_Filter        _SYSTEMD_UNIT=etcd2.service
          Systemd_Filter        _SYSTEMD_UNIT=etcd3.service
          Systemd_Filter        _SYSTEMD_UNIT=etcdadm-check.service
          Systemd_Filter        _SYSTEMD_UNIT=etcdadm-reconfigure.service
          Systemd_Filter        _SYSTEMD_UNIT=etcdadm-save.service
          Systemd_Filter        _SYSTEMD_UNIT=etcdadm-update-status.service
          Systemd_Filter        _SYSTEMD_UNIT=flanneld.service
          Systemd_Filter        _SYSTEMD_UNIT=format-etcd2-volume.service
          Systemd_Filter        _SYSTEMD_UNIT=kube-node-taint-and-uncordon.service
          Systemd_Filter        _SYSTEMD_UNIT=kubelet.service
          Systemd_Filter        _SYSTEMD_UNIT=ldconfig.service
          Systemd_Filter        _SYSTEMD_UNIT=locksmithd.service
          Systemd_Filter        _SYSTEMD_UNIT=logrotate.service
          Systemd_Filter        _SYSTEMD_UNIT=lvm2-monitor.service
          Systemd_Filter        _SYSTEMD_UNIT=mdmon.service
          Systemd_Filter        _SYSTEMD_UNIT=nfs-idmapd.service
          Systemd_Filter        _SYSTEMD_UNIT=nfs-mountd.service
          Systemd_Filter        _SYSTEMD_UNIT=nfs-server.service
          Systemd_Filter        _SYSTEMD_UNIT=nfs-utils.service
          Systemd_Filter        _SYSTEMD_UNIT=node-problem-detector.service
          Systemd_Filter        _SYSTEMD_UNIT=ntp.service
          Systemd_Filter        _SYSTEMD_UNIT=oem-cloudinit.service
          Systemd_Filter        _SYSTEMD_UNIT=rkt-gc.service
          Systemd_Filter        _SYSTEMD_UNIT=rkt-metadata.service
          Systemd_Filter        _SYSTEMD_UNIT=rpc-idmapd.service
          Systemd_Filter        _SYSTEMD_UNIT=rpc-mountd.service
          Systemd_Filter        _SYSTEMD_UNIT=rpc-statd.service
          Systemd_Filter        _SYSTEMD_UNIT=rpcbind.service
          Systemd_Filter        _SYSTEMD_UNIT=set-aws-environment.service
          Systemd_Filter        _SYSTEMD_UNIT=system-cloudinit.service
          Systemd_Filter        _SYSTEMD_UNIT=systemd-timesyncd.service
          Systemd_Filter        _SYSTEMD_UNIT=update-ca-certificates.service
          Systemd_Filter        _SYSTEMD_UNIT=user-cloudinit.service
          Systemd_Filter        _SYSTEMD_UNIT=var-lib-etcd2.service
          Max_Entries           1000
          Read_From_Tail        true
    outputs: |-
      [OUTPUT]
          Name                  forward
          Match                 *
          Host                  ${FLUENTD_LOGS_SVC}.${NAMESPACE}.svc.cluster.local.
          Port                  24321
          tls                   off
          tls.verify            on
          tls.debug             1
      [OUTPUT]
          Name                  test-output-1
    customParsers: |-
      [PARSER]
          Name                  multi_line
          Format                regex
          Regex                 (?<log>^{"log":"\d{4}-\d{1,2}-\d{1,2}.\d{2}:\d{2}:\d{2}.*)
      [PARSER]
          Name                  crio
          Format                regex
          Regex                 ^(?<time>[^ ]+) (?<stream>stdout|stderr) (?<logtag>[^ ]*) (?<log>.*)$
          Time_Key              time
          Time_Format           %Y-%m-%dT%H:%M:%S.%L%z
      [PARSER]
          Name                  test_json
          Format                json
          Time_Key              time
          Time_Format           %Y-%m-%dT%H:%M:%S.%L%z
      [PARSER]
          Name                  test-logfmt-parser-1
          Format                logfmt
      [PARSER]
          Name                  test-regex-parser-1
          Format                regex
          Regex                 .*
    filters: |-
      [FILTER]
          Name                  test-filter-1
