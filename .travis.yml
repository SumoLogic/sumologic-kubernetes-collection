lang: ruby
services: docker
before_install:
  - rm -f ./Gemfile.lock
  - gem install bundler
  - sudo apt update
  - sudo apt install snapd
  - sudo snap install helm --channel=2.16/stable --classic
  - sudo curl https://github.com/mikefarah/yq/releases/download/3.2.1/yq_linux_amd64 -L -o /usr/local/bin/yq-3.2.1
  - sudo chmod +x /usr/local/bin/yq-3.2.1
  - sudo ln -s /usr/local/bin/yq-3.2.1 /usr/local/bin/yq
  - curl -Lo- https://github.com/koalaman/shellcheck/releases/download/v0.7.1/shellcheck-v0.7.1.linux.x86_64.tar.xz | tar -xJf -
  - sudo cp shellcheck-v0.7.1/shellcheck /usr/local/bin
  - rm -rf shellcheck-v0.7.1/
branches:
  only:
  - master
  - /^release-v\d+\.\d+$/
  - /^v\d+\.\d+\.\d+$/
  - /^v\d+\.\d+\.\d+-(alpha|beta|rc)\.\d+$/
jobs:
  include:
    - stage: tests
      script: bash ci/tests.sh
    - stage: build
      script: bash ci/build.sh
