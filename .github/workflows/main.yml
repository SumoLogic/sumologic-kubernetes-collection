name: CI

on:
  push:
    branches:
      - main
      - 'github-actions-env-*'

jobs:
  envs:
    runs-on: ubuntu-20.04
    steps:
      - uses: FranzDiebold/github-env-vars-action@v1.2.1
      - name: Print environment variables
        run: |
          echo "PR from ${GITHUB_REF#refs/heads/} in ref ${GITHUB_REF}"

  build:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-ruby@v1
        with:
          ruby-version: '2.6'
      - run: gem install bundler
      # - name: yq
      #   run: |
      #       curl --retry 10 --retry-max-time 120 --retry-delay 5 -L -o /tmp/yq https://github.com/mikefarah/yq/releases/download/3.4.1/yq_linux_amd64
      #       chmod +x /tmp/yq
      #       sudo mv /tmp/yq /usr/local/bin/yq
      - name: build
        run: make build
      - name: push
        run: make push
